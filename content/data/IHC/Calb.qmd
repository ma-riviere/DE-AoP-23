---
title: "Calbindin"
subtitle: "Interactive data exploration"
---

```{r}
#| output: false

source(here::here("src", "setup.R"), echo = FALSE)

calb_responses <- c("N_CC", "Vol_PC_per_cell")

calb_data <- load_calb_data()
```

::: {.callout-tip appearance="simple"}
Most of the tables and figures on this page are **interactive** !
:::

# Raw Data

Our raw Calbindin data, including some computed variables such as `Vol_PC_per_cell`, which is defined as the `r get_response_name("Vol_PC", "IHC", "Description")` (`Vol_PC`) divided by the `r get_response_name("N_CC", "IHC", "Description")` (`N_CC`).

```{r}
(
  calb_data$clean
  |> select(-ID)
  |> datatable(
    rownames = FALSE,
    class = 'cell-border stripe compact',
    filter = 'top',
    options = list(pageLength = 10, autoWidth = TRUE)
  ) 
  |> formatRound(calb_responses, 4)
)
```

## Data Dictionary

What each variable name represents, and how they are labeled within plots.

```{r}
make_data_dict_reactable(calb_data$clean, configs$data$IHC$data_dict)
```

<!-- Data Composition not required here -->

# Data Summary

```{r}
calb_shared <- calb_data$clean |> pivot_longer(cols = calb_responses, names_to = "Response") |> SharedData$new(data = _)

bscols(
  widths = c(1, 5),
  div(),
  filter_select("resp_filter_calb", "Response", calb_shared, ~ Response, multiple = FALSE)
)
```

```{js}
//| output: false

function filter_default() {
  document.getElementById("resp_filter_calb").getElementsByClassName("selectized")[0].selectize.setValue("N_CC", false)
}

window.onload = filter_default;
```

```{r}
#| fig-width: 10
#| fig-height: 6

(plot_ly(
    calb_shared,
    x = ~ Condition,
    y = ~ value,
    color = ~ Condition,
    type = "box",
    boxpoints = "all", 
    jitter = 0.3,
    colors = c(N = "#02ccae", IH = "#9965db")
  )
  |> layout(
    autosize = TRUE, 
    showlegend = FALSE, 
    xaxis = list(title = NA, type = "category")
  )
)
```

# Correlations

```{r}
#| fig-width: 10

corr_matrix_plot(calb_data$clean, vars = c("Condition", calb_responses))
```
